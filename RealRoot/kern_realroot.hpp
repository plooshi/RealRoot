#ifndef kern_realroot_hpp
#define kern_realroot_hpp

void InitRealRoot();

const uint8_t pivotRootOrig[] = {
    0xbe, 0x33, 0x68, 0x04, 0x80, // mov esi, 0x80046833
    0x4c, 0x89, 0xe7, // mov rdi, r12
    0x31, 0xd2, // xor edx, edx
    0x31, 0xc9, // xor ecx, ecx
    0xe8, 0x00, 0x00, 0x00, 0x00 // call _VNOP_IOCTL
};

const uint8_t pivotRootMask[] = {
    0xff, 0xff, 0xff, 0xff, 0xff,
    0xff, 0xff, 0xff,
    0xff, 0xff,
    0xff, 0xff,
    0xff, 0x00, 0x00, 0x00, 0x00
};

const uint8_t pivotRootReplace[] = {
    0xbe, 0x33, 0x68, 0x04, 0x80, // mov esi, 0x80046833
    0x4c, 0x89, 0xe7, // mov rdi, r12
    0x31, 0xd2, // xor edx, edx
    0x31, 0xc9, // xor ecx, ecx
    0x31, 0xc0, // xor eax, eax
    0x90, // nop
    0x90, // nop
    0x90 // nop
};

const uint8_t pivotRootReplaceMask[] = {
    0xff, 0xff, 0xff, 0xff, 0xff,
    0xff, 0xff, 0xff,
    0xff, 0xff,
    0xff, 0xff,
    0xff, 0xff,
    0xff,
    0xff,
    0xff
};

const uint8_t apfsVfsopMountOrig[] = {
    0xe8, 0x00, 0x00, 0x00, 0x00, // call
    0xe9, 0x00, 0x00, 0x00, 0x00, // jmp
    0x48, 0x8b, 0x80, 0xc0, 0x00, 0x00, 0x00, // mov rax, qword ptr [rXX+0xc0]
    0xf6, 0x40, 0x38, 0x20, // test byte [rax+FlagsOff], 0x20
    0x0f, 0x84, // j(n)e
};

const uint8_t apfsVfsopMountMask[] = {
    0xff, 0x00, 0x00, 0x00, 0x00,
    0xff, 0x00, 0x00, 0x00, 0x00,
    0xfd, 0xff, 0xf0, 0xff, 0xff, 0xff, 0xff,
    0xff, 0xff, 0xff, 0xff,
    0xff, 0xfe
};

#endif /* kern_realroot_hpp */
